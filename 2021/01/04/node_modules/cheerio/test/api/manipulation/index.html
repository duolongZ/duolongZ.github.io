<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="var expect &#x3D; require(&#39;expect.js&#39;),     cheerio &#x3D; require(&#39;..&#x2F;..&#39;),     fruits &#x3D; require(&#39;..&#x2F;fixtures&#39;).fruits,     toArray &#x3D; Function.call.bind(Array.prototype.slice);  describe(&#39;$(...)&#39;, function() {">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2021/01/04/node_modules/cheerio/test/api/manipulation/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="var expect &#x3D; require(&#39;expect.js&#39;),     cheerio &#x3D; require(&#39;..&#x2F;..&#39;),     fruits &#x3D; require(&#39;..&#x2F;fixtures&#39;).fruits,     toArray &#x3D; Function.call.bind(Array.prototype.slice);  describe(&#39;$(...)&#39;, function() {">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-04T15:49:38.247Z">
<meta property="article:modified_time" content="2015-01-24T21:47:06.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-node_modules/cheerio/test/api/manipulation" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/04/node_modules/cheerio/test/api/manipulation/" class="article-date">
  <time class="dt-published" datetime="2021-01-04T15:49:38.247Z" itemprop="datePublished">2021-01-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        var expect = require('expect.js'),
    cheerio = require('../..'),
    fruits = require('../fixtures').fruits,
    toArray = Function.call.bind(Array.prototype.slice);

describe('$(...)', function() {

  var $, $fruits;

  beforeEach(function() {
    $ = cheerio.load(fruits);
    $fruits = $('#fruits');
  });

  describe('.append', function() {

    it('() : should do nothing', function() {
      expect($('#fruits').append()[0].tagName).to.equal('ul');
    });

    it('(html) : should add element as last child', function() {
      $fruits.append('<li class="plum">Plum</li>');
      expect($fruits.children().eq(3).hasClass('plum')).to.be.ok();
    });

    it('($(...)) : should add element as last child', function() {
      var $plum = $('<li class="plum">Plum</li>');
      $fruits.append($plum);
      expect($fruits.children().eq(3).hasClass('plum')).to.be.ok();
    });

    it('(Node) : should add element as last child', function() {
      var plum = $('<li class="plum">Plum</li>')[0];
      $fruits.append(plum);
      expect($fruits.children().eq(3).hasClass('plum')).to.be.ok();
    });

    it('(existing Node) : should remove node from previous location', function() {
      var apple = $fruits.children()[0];
      var $children;

      expect($fruits.children()).to.have.length(3);
      $fruits.append(apple);
      $children = $fruits.children();

      expect($children).to.have.length(3);
      expect($children[0]).to.not.equal(apple);
      expect($children[2]).to.equal(apple);
    });

    it('(existing Node) : should remove existing node from previous location', function() {
      var apple = $fruits.children()[0];
      var $children;
      var $dest = $('<div></div>');

      expect($fruits.children()).to.have.length(3);
      $dest.append(apple);
      $children = $fruits.children();

      expect($children).to.have.length(2);
      expect($children[0]).to.not.equal(apple);

      expect($dest.children()).to.have.length(1);
      expect($dest.children()[0]).to.equal(apple);
    });

    it('(existing Node) : should update original direct siblings', function() {
      $('.pear').append($('.orange'));
      expect($('.apple').next()[0]).to.be($('.pear')[0]);
      expect($('.pear').prev()[0]).to.be($('.apple')[0]);
    });

    it('(existing Node) : should clone all but the last occurrence', function() {
      var $originalApple = $('.apple');
      var $apples;

      $('.orange, .pear').append($originalApple);

      $apples = $('.apple');
      expect($apples).to.have.length(2);
      expect($apples.eq(0).parent()[0]).to.be($('.orange')[0]);
      expect($apples.eq(1).parent()[0]).to.be($('.pear')[0]);
      expect($apples[1]).to.be($originalApple[0]);
    });

    it('(elem) : should NOP if removed', function() {
      var $apple = $('.apple');

      $apple.remove();
      $fruits.append($apple);
      expect($fruits.children().eq(2).hasClass('apple')).to.be.ok();
    });

    it('($(...), html) : should add multiple elements as last children', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var grape = '<li class="grape">Grape</li>';
      $fruits.append($plum, grape);
      expect($fruits.children().eq(3).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(4).hasClass('grape')).to.be.ok();
    });

    it('(Array) : should append all elements in the array', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>')
        .get();
      $fruits.append(more);
      expect($fruits.children().eq(3).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(4).hasClass('grape')).to.be.ok();
    });

    it('(fn) : should invoke the callback with the correct arguments and context', function() {
      $fruits = $fruits.children();
      var args = [];
      var thisValues = [];

      $fruits.append(function() {
        args.push(toArray(arguments));
        thisValues.push(this);
      });

      expect(args).to.eql([
        [0, 'Apple'],
        [1, 'Orange'],
        [2, 'Pear']
      ]);
      expect(thisValues).to.eql([
        $fruits[0],
        $fruits[1],
        $fruits[2]
      ]);
    });

    it('(fn) : should add returned string as last child', function() {
      $fruits = $fruits.children();
      var $apple, $orange, $pear;

      $fruits.append(function() {
        return '<div class="first">';
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.first')[0]).to.equal($apple.contents()[1]);
      expect($orange.find('.first')[0]).to.equal($orange.contents()[1]);
      expect($pear.find('.first')[0]).to.equal($pear.contents()[1]);
    });

    it('(fn) : should add returned Cheerio object as last child', function() {
      var $apple, $orange, $pear;
      $fruits = $fruits.children();

      $fruits.append(function() {
        return $('<div class="second">');
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.second')[0]).to.equal($apple.contents()[1]);
      expect($orange.find('.second')[0]).to.equal($orange.contents()[1]);
      expect($pear.find('.second')[0]).to.equal($pear.contents()[1]);
    });

    it('(fn) : should add returned Node as last child', function() {
      var $apple, $orange, $pear;
      $fruits = $fruits.children();

      $fruits.append(function() {
        return $('<div class="third">')[0];
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.third')[0]).to.equal($apple.contents()[1]);
      expect($orange.find('.third')[0]).to.equal($orange.contents()[1]);
      expect($pear.find('.third')[0]).to.equal($pear.contents()[1]);
    });

    it('should maintain correct object state (Issue: #10)', function() {
      var $obj = $('<div></div>')
        .append('<div><div></div></div>')
        .children()
        .children()
        .parent();
      expect($obj).to.be.ok();
    });

    it('($(...)) : should remove from root element', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var root = $plum[0].root;
      expect(root).to.be.ok();

      $fruits.append($plum);
      expect($plum[0].root).to.not.be.ok();
      expect(root.childNodes).to.not.contain($plum[0]);
    });
  });

  describe('.prepend', function() {

    it('() : should do nothing', function() {
      expect($('#fruits').prepend()[0].tagName).to.equal('ul');
    });

    it('(html) : should add element as first child', function() {
      $fruits.prepend('<li class="plum">Plum</li>');
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
    });

    it('($(...)) : should add element as first child', function() {
      var $plum = $('<li class="plum">Plum</li>');
      $fruits.prepend($plum);
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
    });

    it('(Node) : should add node as first child', function() {
      var plum = $('<li class="plum">Plum</li>')[0];
      $fruits.prepend(plum);
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
    });

    it('(existing Node) : should remove existing nodes from previous locations', function() {
      var pear = $fruits.children()[2];
      var $children;

      expect($fruits.children()).to.have.length(3);
      $fruits.prepend(pear);
      $children = $fruits.children();

      expect($children).to.have.length(3);
      expect($children[2]).to.not.equal(pear);
      expect($children[0]).to.equal(pear);
    });

    it('(existing Node) : should update original direct siblings', function() {
      $('.pear').prepend($('.orange'));
      expect($('.apple').next()[0]).to.be($('.pear')[0]);
      expect($('.pear').prev()[0]).to.be($('.apple')[0]);
    });

    it('(existing Node) : should clone all but the last occurrence', function() {
      var $originalApple = $('.apple');
      var $apples;

      $('.orange, .pear').prepend($originalApple);

      $apples = $('.apple');
      expect($apples).to.have.length(2);
      expect($apples.eq(0).parent()[0]).to.be($('.orange')[0]);
      expect($apples.eq(1).parent()[0]).to.be($('.pear')[0]);
      expect($apples[1]).to.be($originalApple[0]);
    });

    it('(elem) : should handle if removed', function() {
      var $apple = $('.apple');

      $apple.remove();
      $fruits.prepend($apple);
      expect($fruits.children().eq(0).hasClass('apple')).to.be.ok();
    });

    it('(Array) : should add all elements in the array as inital children', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>')
        .get();
      $fruits.prepend(more);
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(1).hasClass('grape')).to.be.ok();
    });

    it('(html, $(...), html) : should add multiple elements as first children', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var grape = '<li class="grape">Grape</li>';
      $fruits.prepend($plum, grape);
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(1).hasClass('grape')).to.be.ok();
    });

    it('(fn) : should invoke the callback with the correct arguments and context', function() {
      var args = [];
      var thisValues = [];
      $fruits = $fruits.children();

      $fruits.prepend(function() {
        args.push(toArray(arguments));
        thisValues.push(this);
      });

      expect(args).to.eql([
        [0, 'Apple'],
        [1, 'Orange'],
        [2, 'Pear']
      ]);
      expect(thisValues).to.eql([
        $fruits[0],
        $fruits[1],
        $fruits[2]
      ]);
    });

    it('(fn) : should add returned string as first child', function() {
      var $apple, $orange, $pear;
      $fruits = $fruits.children();

      $fruits.prepend(function() {
        return '<div class="first">';
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.first')[0]).to.equal($apple.contents()[0]);
      expect($orange.find('.first')[0]).to.equal($orange.contents()[0]);
      expect($pear.find('.first')[0]).to.equal($pear.contents()[0]);
    });

    it('(fn) : should add returned Cheerio object as first child', function() {
      var $apple, $orange, $pear;
      $fruits = $fruits.children();

      $fruits.prepend(function() {
        return $('<div class="second">');
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.second')[0]).to.equal($apple.contents()[0]);
      expect($orange.find('.second')[0]).to.equal($orange.contents()[0]);
      expect($pear.find('.second')[0]).to.equal($pear.contents()[0]);
    });

    it('(fn) : should add returned Node as first child', function() {
      var $apple, $orange, $pear;
      $fruits = $fruits.children();

      $fruits.prepend(function() {
        return $('<div class="third">')[0];
      });

      $apple = $fruits.eq(0);
      $orange = $fruits.eq(1);
      $pear = $fruits.eq(2);

      expect($apple.find('.third')[0]).to.equal($apple.contents()[0]);
      expect($orange.find('.third')[0]).to.equal($orange.contents()[0]);
      expect($pear.find('.third')[0]).to.equal($pear.contents()[0]);
    });


    it('($(...)) : should remove from root element', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var root = $plum[0].root;
      expect(root).to.be.ok();

      $fruits.prepend($plum);
      expect($plum[0].root).to.not.be.ok();
      expect(root.childNodes).to.not.contain($plum[0]);
    });
  });

  describe('.after', function() {

    it('() : should do nothing', function() {
      expect($('#fruits').after()[0].tagName).to.equal('ul');
    });

    it('(html) : should add element as next sibling', function() {
      var grape = '<li class="grape">Grape</li>';
      $('.apple').after(grape);
      expect($('.apple').next().hasClass('grape')).to.be.ok();
    });

    it('(Array) : should add all elements in the array as next sibling', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>')
        .get();
      $('.apple').after(more);
      expect($fruits.children().eq(1).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(2).hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should add element as next sibling', function() {
      var $plum = $('<li class="plum">Plum</li>');
      $('.apple').after($plum);
      expect($('.apple').next().hasClass('plum')).to.be.ok();
    });

    it('(Node) : should add element as next sibling', function() {
      var plum = $('<li class="plum">Plum</li>')[0];
      $('.apple').after(plum);
      expect($('.apple').next().hasClass('plum')).to.be.ok();
    });

    it('(existing Node) : should remove existing nodes from previous locations', function() {
      var pear = $fruits.children()[2];
      var $children;

      $('.apple').after(pear);

      $children = $fruits.children();
      expect($children).to.have.length(3);
      expect($children[1]).to.be(pear);
    });

    it('(existing Node) : should update original direct siblings', function() {
      $('.pear').after($('.orange'));
      expect($('.apple').next()[0]).to.be($('.pear')[0]);
      expect($('.pear').prev()[0]).to.be($('.apple')[0]);
    });

    it('(existing Node) : should clone all but the last occurrence', function() {
      var $originalApple = $('.apple');
      $('.orange, .pear').after($originalApple);

      expect($('.apple')).to.have.length(2);
      expect($('.apple').eq(0).prev()[0]).to.be($('.orange')[0]);
      expect($('.apple').eq(0).next()[0]).to.be($('.pear')[0]);
      expect($('.apple').eq(1).prev()[0]).to.be($('.pear')[0]);
      expect($('.apple').eq(1).next()).to.have.length(0);
      expect($('.apple')[0]).to.not.eql($originalApple[0]);
      expect($('.apple')[1]).to.eql($originalApple[0]);
    });

    it('(elem) : should handle if removed', function() {
      var $apple = $('.apple');
      var $plum = $('<li class="plum">Plum</li>');

      $apple.remove();
      $apple.after($plum);
      expect($plum.prev()).to.be.empty();
    });

    it('($(...), html) : should add multiple elements as next siblings', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var grape = '<li class="grape">Grape</li>';
      $('.apple').after($plum, grape);
      expect($('.apple').next().hasClass('plum')).to.be.ok();
      expect($('.plum').next().hasClass('grape')).to.be.ok();
    });

    it('(fn) : should invoke the callback with the correct arguments and context', function() {
      var args = [];
      var thisValues = [];
      $fruits = $fruits.children();

      $fruits.after(function() {
        args.push(toArray(arguments));
        thisValues.push(this);
      });

      expect(args).to.eql([[0, 'Apple'], [1, 'Orange'], [2, 'Pear']]);
      expect(thisValues).to.eql([
        $fruits[0],
        $fruits[1],
        $fruits[2]
      ]);
    });

    it('(fn) : should add returned string as next sibling', function() {
      $fruits = $fruits.children();

      $fruits.after(function() {
        return '<li class="first">';
      });

      expect($('.first')[0]).to.equal($('#fruits').contents()[1]);
      expect($('.first')[1]).to.equal($('#fruits').contents()[3]);
      expect($('.first')[2]).to.equal($('#fruits').contents()[5]);
    });

    it('(fn) : should add returned Cheerio object as next sibling', function() {
      $fruits = $fruits.children();

      $fruits.after(function() {
        return $('<li class="second">');
      });

      expect($('.second')[0]).to.equal($('#fruits').contents()[1]);
      expect($('.second')[1]).to.equal($('#fruits').contents()[3]);
      expect($('.second')[2]).to.equal($('#fruits').contents()[5]);
    });

    it('(fn) : should add returned element as next sibling', function() {
      $fruits = $fruits.children();

      $fruits.after(function() {
        return $('<li class="third">')[0];
      });

      expect($('.third')[0]).to.equal($('#fruits').contents()[1]);
      expect($('.third')[1]).to.equal($('#fruits').contents()[3]);
      expect($('.third')[2]).to.equal($('#fruits').contents()[5]);
    });

    it('($(...)) : should remove from root element', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var root = $plum[0].root;
      expect(root).to.be.ok();

      $fruits.after($plum);
      expect($plum[0].root).to.not.be.ok();
      expect(root.childNodes).to.not.contain($plum[0]);
    });
  });

  describe('.insertAfter', function() {

    it('(selector) : should create element and add as next sibling', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertAfter('.apple');
      expect($('.apple').next().hasClass('grape')).to.be.ok();
    });

    it('(selector) : should create element and add as next sibling of multiple elements', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertAfter('.apple, .pear');
      expect($('.apple').next().hasClass('grape')).to.be.ok();
      expect($('.pear').next().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create element and add as next sibling', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertAfter($('.apple'));
      expect($('.apple').next().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create element and add as next sibling of multiple elements', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertAfter($('.apple, .pear'));
      expect($('.apple').next().hasClass('grape')).to.be.ok();
      expect($('.pear').next().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create all elements in the array and add as next siblings', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>');
      more.insertAfter($('.apple'));
      expect($fruits.children().eq(0).hasClass('apple')).to.be.ok();
      expect($fruits.children().eq(1).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(2).hasClass('grape')).to.be.ok();
    });

    it('(existing Node) : should remove existing nodes from previous locations', function() {
      $('.orange').insertAfter('.pear');
      expect($fruits.children().eq(1).hasClass('orange')).to.not.be.ok();
      expect($fruits.children().length).to.be(3);
      expect($('.orange').length).to.be(1);
    });

    it('(existing Node) : should update original direct siblings', function() {
      $('.orange').insertAfter('.pear');
      expect($('.apple').next().hasClass('pear')).to.be.ok();
      expect($('.pear').prev().hasClass('apple')).to.be.ok();
      expect($('.pear').next().hasClass('orange')).to.be.ok();
      expect($('.orange').next()).to.be.empty();
    });

    it('(existing Node) : should update original direct siblings of multiple elements', function() {
      $('.apple').insertAfter('.orange, .pear');
      expect($('.orange').prev()).to.be.empty();
      expect($('.orange').next().hasClass('apple')).to.be.ok();
      expect($('.pear').next().hasClass('apple')).to.be.ok();
      expect($('.pear').prev().hasClass('apple')).to.be.ok();
      expect($fruits.children().length).to.be(4);
      var apples = $('.apple');
      expect(apples.length).to.be(2);
      expect(apples.eq(0).prev().hasClass('orange')).to.be.ok();
      expect(apples.eq(1).prev().hasClass('pear')).to.be.ok();
    });

    it('(elem) : should handle if removed', function() {
      var $apple = $('.apple');
      var $plum = $('<li class="plum">Plum</li>');
      $apple.remove();
      $plum.insertAfter($apple);
      expect($plum.prev()).to.be.empty();
    });

    it('(single) should return the new element for chaining', function() {
      var $grape = $('<li class="grape">Grape</li>').insertAfter('.apple');
      expect($grape.cheerio).to.be.ok();
      expect($grape.each).to.be.ok();
      expect($grape.length).to.be(1);
      expect($grape.hasClass('grape')).to.be.ok();
    });

    it('(single) should return the new elements for chaining', function() {
      var $purple = $('<li class="grape">Grape</li><li class="plum">Plum</li>').insertAfter('.apple');
      expect($purple.cheerio).to.be.ok();
      expect($purple.each).to.be.ok();
      expect($purple.length).to.be(2);
      expect($purple.eq(0).hasClass('grape')).to.be.ok();
      expect($purple.eq(1).hasClass('plum')).to.be.ok();
    });

    it('(multiple) should return the new elements for chaining', function() {
      var $purple = $('<li class="grape">Grape</li><li class="plum">Plum</li>').insertAfter('.apple, .pear');
      expect($purple.cheerio).to.be.ok();
      expect($purple.each).to.be.ok();
      expect($purple.length).to.be(4);
      expect($purple.eq(0).hasClass('grape')).to.be.ok();
      expect($purple.eq(1).hasClass('plum')).to.be.ok();
      expect($purple.eq(2).hasClass('grape')).to.be.ok();
      expect($purple.eq(3).hasClass('plum')).to.be.ok();
    });

    it('(single) should return the existing element for chaining', function() {
      var $pear = $('.pear').insertAfter('.apple');
      expect($pear.cheerio).to.be.ok();
      expect($pear.each).to.be.ok();
      expect($pear.length).to.be(1);
      expect($pear.hasClass('pear')).to.be.ok();
    });

    it('(single) should return the existing elements for chaining', function() {
      var $things = $('.orange, .apple').insertAfter('.pear');
      expect($things.cheerio).to.be.ok();
      expect($things.each).to.be.ok();
      expect($things.length).to.be(2);
      expect($things.eq(0).hasClass('apple')).to.be.ok();
      expect($things.eq(1).hasClass('orange')).to.be.ok();
    });

    it('(multiple) should return the existing elements for chaining', function() {
      $('<li class="grape">Grape</li>').insertAfter('.apple');
      var $things = $('.orange, .apple').insertAfter('.pear, .grape');
      expect($things.cheerio).to.be.ok();
      expect($things.each).to.be.ok();
      expect($things.length).to.be(4);
      expect($things.eq(0).hasClass('apple')).to.be.ok();
      expect($things.eq(1).hasClass('orange')).to.be.ok();
      expect($things.eq(2).hasClass('apple')).to.be.ok();
      expect($things.eq(3).hasClass('orange')).to.be.ok();
    });

  });

  describe('.before', function() {

    it('() : should do nothing', function() {
      expect($('#fruits').before()[0].tagName).to.equal('ul');
    });

    it('(html) : should add element as previous sibling', function() {
      var grape = '<li class="grape">Grape</li>';
      $('.apple').before(grape);
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should add element as previous sibling', function() {
      var $plum = $('<li class="plum">Plum</li>');
      $('.apple').before($plum);
      expect($('.apple').prev().hasClass('plum')).to.be.ok();
    });

    it('(Node) : should add element as previous sibling', function() {
      var plum = $('<li class="plum">Plum</li>');
      $('.apple').before(plum);
      expect($('.apple').prev().hasClass('plum')).to.be.ok();
    });

    it('(existing Node) : should remove existing nodes from previous locations', function() {
      var pear = $fruits.children()[2];
      var $children;

      $('.apple').before(pear);

      $children = $fruits.children();
      expect($children).to.have.length(3);
      expect($children[0]).to.be(pear);
    });

    it('(existing Node) : should update original direct siblings', function() {
      $('.apple').before($('.orange'));
      expect($('.apple').next()[0]).to.be($('.pear')[0]);
      expect($('.pear').prev()[0]).to.be($('.apple')[0]);
    });

    it('(existing Node) : should clone all but the last occurrence', function() {
      var $originalPear = $('.pear');
      $('.apple, .orange').before($originalPear);

      expect($('.pear')).to.have.length(2);
      expect($('.pear').eq(0).prev()).to.have.length(0);
      expect($('.pear').eq(0).next()[0]).to.be($('.apple')[0]);
      expect($('.pear').eq(1).prev()[0]).to.be($('.apple')[0]);
      expect($('.pear').eq(1).next()[0]).to.be($('.orange')[0]);
      expect($('.pear')[0]).to.not.eql($originalPear[0]);
      expect($('.pear')[1]).to.eql($originalPear[0]);
    });

    it('(elem) : should handle if removed', function() {
      var $apple = $('.apple');
      var $plum = $('<li class="plum">Plum</li>');

      $apple.remove();
      $apple.before($plum);
      expect($plum.next()).to.be.empty();
    });

    it('(Array) : should add all elements in the array as previous sibling', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>')
        .get();
      $('.apple').before(more);
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(1).hasClass('grape')).to.be.ok();
    });

    it('($(...), html) : should add multiple elements as previous siblings', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var grape = '<li class="grape">Grape</li>';
      $('.apple').before($plum, grape);
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
      expect($('.grape').prev().hasClass('plum')).to.be.ok();
    });

    it('(fn) : should invoke the callback with the correct arguments and context', function() {
      var args = [];
      var thisValues = [];
      $fruits = $fruits.children();

      $fruits.before(function() {
        args.push(toArray(arguments));
        thisValues.push(this);
      });

      expect(args).to.eql([[0, 'Apple'], [1, 'Orange'], [2, 'Pear']]);
      expect(thisValues).to.eql([
        $fruits[0],
        $fruits[1],
        $fruits[2]
      ]);
    });

    it('(fn) : should add returned string as previous sibling', function() {
      $fruits = $fruits.children();

      $fruits.before(function() {
        return '<li class="first">';
      });

      expect($('.first')[0]).to.equal($('#fruits').contents()[0]);
      expect($('.first')[1]).to.equal($('#fruits').contents()[2]);
      expect($('.first')[2]).to.equal($('#fruits').contents()[4]);
    });

    it('(fn) : should add returned Cheerio object as previous sibling', function() {
      $fruits = $fruits.children();

      $fruits.before(function() {
        return $('<li class="second">');
      });

      expect($('.second')[0]).to.equal($('#fruits').contents()[0]);
      expect($('.second')[1]).to.equal($('#fruits').contents()[2]);
      expect($('.second')[2]).to.equal($('#fruits').contents()[4]);
    });

    it('(fn) : should add returned Node as previous sibling', function() {
      $fruits = $fruits.children();

      $fruits.before(function() {
        return $('<li class="third">')[0];
      });

      expect($('.third')[0]).to.equal($('#fruits').contents()[0]);
      expect($('.third')[1]).to.equal($('#fruits').contents()[2]);
      expect($('.third')[2]).to.equal($('#fruits').contents()[4]);
    });

    it('($(...)) : should remove from root element', function() {
      var $plum = $('<li class="plum">Plum</li>');
      var root = $plum[0].root;
      expect(root).to.be.ok();

      $fruits.before($plum);
      expect($plum[0].root).to.not.be.ok();
      expect(root.childNodes).to.not.contain($plum[0]);
    });
  });

  describe('.insertBefore', function() {

    it('(selector) : should create element and add as prev sibling', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertBefore('.apple');
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
    });

    it('(selector) : should create element and add as prev sibling of multiple elements', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertBefore('.apple, .pear');
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
      expect($('.pear').prev().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create element and add as prev sibling', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertBefore($('.apple'));
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create element and add as next sibling of multiple elements', function() {
      var grape = $('<li class="grape">Grape</li>');
      grape.insertBefore($('.apple, .pear'));
      expect($('.apple').prev().hasClass('grape')).to.be.ok();
      expect($('.pear').prev().hasClass('grape')).to.be.ok();
    });

    it('($(...)) : should create all elements in the array and add as prev siblings', function() {
      var more = $('<li class="plum">Plum</li><li class="grape">Grape</li>');
      more.insertBefore($('.apple'));
      expect($fruits.children().eq(0).hasClass('plum')).to.be.ok();
      expect($fruits.children().eq(1).hasClass('grape')).to.be.ok();
      expect($fruits.children().eq(2).hasClass('apple')).to.be.ok();
    });

    it('(existing Node) : should remove existing nodes from previous locations', function() {
      $('.pear').insertBefore('.apple');
      expect($fruits.children().eq(2).hasClass(